<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laurino Tavern - Manager Display</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Source+Sans+Pro:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Laurino Tavern Brand Colors - Light Mode */
            --primary-dark: #8B7355;
            --secondary-dark: #A68B6B;
            --tertiary-dark: #2C5F7C;
            --primary-light: #ffffff;
            --blue-pastel: #7FA7B8;
            --lighter-blue: #A8C4D4;
            --background: #FAF8F5;
            --accent: #E8DFD3;
            --highlight: #D4A574;
            --card-background: #ffffff;
            --border: #e0e0e0;
            --text: #8B7355;
            --text-primary: #5a4a3a;
            --muted-text: #A68B6B;
            --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.12);
            --shadow-heavy: 0 8px 32px rgba(0, 0, 0, 0.16);
            --radius-small: 6px;
            --radius-medium: 8px;
            --radius-large: 12px;
            --radius-xl: 16px;
            
            /* Tag Colors */
            --tag-important: #E07B5D;
            --tag-important-bg: rgba(224, 123, 93, 0.15);
            --tag-birthday: #9B7ED9;
            --tag-birthday-bg: rgba(155, 126, 217, 0.15);
            --tag-party: #D4A574;
            --tag-party-bg: rgba(212, 165, 116, 0.15);
        }

        /* Dark Mode Colors */
        [data-theme="dark"] {
            --primary-dark: #D4A574;
            --secondary-dark: #A68B6B;
            --tertiary-dark: #7FA7B8;
            --primary-light: #1a1a1a;
            --blue-pastel: #5a8a9a;
            --lighter-blue: #4a7a8a;
            --background: #1a1612;
            --accent: #2a2420;
            --highlight: #D4A574;
            --card-background: #252018;
            --border: #3a3530;
            --text: #E8DFD3;
            --text-primary: #ffffff;
            --muted-text: #A68B6B;
            --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.3);
            --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.4);
            --shadow-heavy: 0 8px 32px rgba(0, 0, 0, 0.5);
            
            --tag-important-bg: rgba(224, 123, 93, 0.25);
            --tag-birthday-bg: rgba(155, 126, 217, 0.25);
            --tag-party-bg: rgba(212, 165, 116, 0.25);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Source Sans Pro', sans-serif;
            background: var(--background);
            color: var(--text);
            height: 100vh;
            padding: 10px 20px;
            -webkit-font-smoothing: antialiased;
            transition: background 0.3s ease, color 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* Header - Compact for ultrawide monitor */
        .header {
            text-align: center;
            padding-bottom: 6px;
            border-bottom: 2px solid var(--accent);
            margin-bottom: 8px;
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            text-align: left;
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary-dark);
            letter-spacing: 0.03em;
            line-height: 1.1;
        }

        .header .subtitle {
            font-size: 0.75rem;
            color: var(--tertiary-dark);
            letter-spacing: 0.12em;
            text-transform: uppercase;
            margin-top: 2px;
        }

        .header-right {
            text-align: right;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 14px;
        }

        .current-date {
            font-size: 0.9rem;
            color: var(--secondary-dark);
            font-weight: 500;
        }

        .theme-toggle {
            background: var(--card-background);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 5px 10px;
            border-radius: var(--radius-medium);
            cursor: pointer;
            font-size: 0.7rem;
            font-family: 'Source Sans Pro', sans-serif;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .theme-toggle:hover {
            background: var(--tertiary-dark);
            color: white;
            border-color: var(--tertiary-dark);
        }

        .theme-icon {
            font-size: 0.8rem;
        }

        /* Main Layout - Optimized for 21:9 ultrawide monitor (LG 29UM59A) */
        .main-content {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 280px;
            gap: 16px;
            min-height: 0;
            overflow: hidden;
        }

        /* Calendar Section - includes events at bottom */
        .calendar-section {
            background: var(--card-background);
            border-radius: var(--radius-large);
            padding: 10px 14px;
            box-shadow: var(--shadow-medium);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: background 0.3s ease, border-color 0.3s ease;
            overflow: hidden;
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            color: var(--primary-dark);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .section-title::before {
            content: '';
            width: 3px;
            height: 16px;
            background: linear-gradient(180deg, var(--tertiary-dark) 0%, var(--blue-pastel) 100%);
            border-radius: 2px;
        }

        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            flex-shrink: 0;
        }

        .calendar-month {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .nav-buttons { display: flex; gap: 5px; }

        .nav-btn {
            background: var(--background);
            border: 1px solid var(--border);
            color: var(--secondary-dark);
            padding: 3px 8px;
            border-radius: var(--radius-medium);
            cursor: pointer;
            font-size: 0.7rem;
            font-family: 'Source Sans Pro', sans-serif;
            transition: all 0.2s ease;
        }

        .nav-btn:hover {
            background: var(--tertiary-dark);
            color: white;
            border-color: var(--tertiary-dark);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
            flex: 1;
            align-content: start;
        }

        .calendar-header {
            text-align: center;
            padding: 3px 2px;
            font-weight: 600;
            color: var(--tertiary-dark);
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .calendar-day {
            background: var(--background);
            border-radius: var(--radius-small);
            padding: 3px 4px;
            display: flex;
            flex-direction: column;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            min-height: 38px;
        }

        .calendar-day:hover {
            background: var(--accent);
            border-color: var(--border);
        }

        .calendar-day.other-month { opacity: 0.3; }

        .calendar-day.today {
            border: 2px solid var(--highlight);
            background: rgba(212, 165, 116, 0.15);
            box-shadow: var(--shadow-light);
        }

        .day-number {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--muted-text);
            margin-bottom: 1px;
        }

        .calendar-day.today .day-number {
            color: var(--highlight);
            font-weight: 700;
        }

        .manager-name {
            font-size: 0.65rem;
            color: var(--text-primary);
            font-weight: 700;
            line-height: 1.1;
            background: linear-gradient(135deg, var(--tertiary-dark), var(--blue-pastel));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Events Section - Horizontal bar at bottom of calendar */
        .events-section {
            border-top: 1px solid var(--border);
            padding-top: 8px;
            margin-top: 8px;
            flex-shrink: 0;
        }

        .events-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--muted-text);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .events-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .event-item {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: var(--radius-medium);
            border-left: 3px solid;
            font-size: 0.7rem;
            max-width: 280px;
        }

        .event-item.important {
            background: var(--tag-important-bg);
            border-left-color: var(--tag-important);
        }

        .event-item.birthday {
            background: var(--tag-birthday-bg);
            border-left-color: var(--tag-birthday);
        }

        .event-item.party {
            background: var(--tag-party-bg);
            border-left-color: var(--tag-party);
        }

        .event-date {
            font-weight: 600;
            color: var(--text-primary);
            flex-shrink: 0;
        }

        .event-tag {
            font-size: 0.55rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            padding: 2px 5px;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .event-tag.important {
            background: var(--tag-important);
            color: white;
        }

        .event-tag.birthday {
            background: var(--tag-birthday);
            color: white;
        }

        .event-tag.party {
            background: var(--tag-party);
            color: white;
        }

        .event-description {
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .no-events {
            font-size: 0.75rem;
            color: var(--muted-text);
            font-style: italic;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow: hidden;
        }

        /* Today's Manager Card */
        .today-card {
            background: linear-gradient(135deg, var(--tertiary-dark) 0%, var(--blue-pastel) 100%);
            border-radius: var(--radius-large);
            padding: 14px 16px;
            text-align: center;
            box-shadow: var(--shadow-heavy);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .today-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        }

        .today-card .label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: rgba(255,255,255,0.85);
            margin-bottom: 4px;
            position: relative;
        }

        .today-card .manager {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 700;
            color: white;
            position: relative;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .today-card .date {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.9);
            margin-top: 2px;
            position: relative;
        }

        /* Team Note Card */
        .note-card {
            background: var(--card-background);
            border-radius: var(--radius-large);
            padding: 10px 14px;
            box-shadow: var(--shadow-medium);
            border-left: 3px solid var(--highlight);
            transition: background 0.3s ease;
            flex: 1;
            min-height: 50px;
            max-height: 140px;
            overflow-y: auto;
        }

        .note-card .label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--muted-text);
            margin-bottom: 5px;
        }

        .note-card .note-text {
            font-size: 0.85rem;
            color: var(--text-primary);
            line-height: 1.4;
            font-style: italic;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .note-card .note-text.empty {
            color: var(--muted-text);
            font-style: normal;
        }

        .note-card .note-author {
            font-size: 0.75rem;
            color: var(--secondary-dark);
            margin-top: 5px;
            font-weight: 500;
        }

        /* Quote Card - Compact */
        .quote-card {
            background: var(--card-background);
            border-radius: var(--radius-large);
            padding: 8px 12px;
            box-shadow: var(--shadow-medium);
            border: 1px solid var(--border);
            position: relative;
            flex-shrink: 0;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: background 0.3s ease, border-color 0.3s ease;
        }

        .quote-mark {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: var(--accent);
            line-height: 1;
            position: absolute;
            top: 4px;
            left: 8px;
        }

        .quote-card .label {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--muted-text);
            margin-bottom: 3px;
        }

        .quote-text {
            font-size: 0.75rem;
            color: var(--text-primary);
            line-height: 1.3;
            font-style: italic;
            padding-left: 12px;
        }

        .quote-author {
            font-size: 0.65rem;
            color: var(--secondary-dark);
            margin-top: 3px;
            padding-left: 12px;
            font-weight: 500;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding-top: 5px;
            margin-top: auto;
            font-size: 0.6rem;
            color: var(--muted-text);
            flex-shrink: 0;
        }

        .status-dot {
            display: inline-block;
            width: 5px;
            height: 5px;
            background: #4CAF50;
            border-radius: 50%;
            margin-right: 4px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: var(--background);
            border-radius: 2px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-dark);
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-left">
                <h1>Laurino Tavern</h1>
                <div class="subtitle">Manager on Duty</div>
            </div>
            <div class="header-right">
                <div class="current-date" id="currentDate"></div>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <span class="theme-icon" id="themeIcon">ðŸŒ™</span>
                    <span id="themeText">Dark</span>
                </button>
            </div>
        </header>

        <main class="main-content">
            <section class="calendar-section">
                <h2 class="section-title">Schedule</h2>
                <div class="calendar-nav">
                    <span class="calendar-month" id="calendarMonth"></span>
                    <div class="nav-buttons">
                        <button class="nav-btn" onclick="changeMonth(-1)">Prev</button>
                        <button class="nav-btn" onclick="goToToday()">Today</button>
                        <button class="nav-btn" onclick="changeMonth(1)">Next</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <div class="calendar-header">Sun</div>
                    <div class="calendar-header">Mon</div>
                    <div class="calendar-header">Tue</div>
                    <div class="calendar-header">Wed</div>
                    <div class="calendar-header">Thu</div>
                    <div class="calendar-header">Fri</div>
                    <div class="calendar-header">Sat</div>
                </div>
                
                <!-- Events inline at bottom of calendar -->
                <div class="events-section" id="eventsSection">
                    <div class="events-title">ðŸ“… Upcoming Events</div>
                    <div class="events-list" id="eventsList">
                        <span class="no-events">No tagged events this month</span>
                    </div>
                </div>
            </section>

            <aside class="sidebar">
                <div class="today-card">
                    <div class="label">Today's Manager</div>
                    <div class="manager" id="todayManager">--</div>
                    <div class="date" id="todayDate"></div>
                </div>

                <div class="note-card">
                    <div class="label">ðŸ“‹ Team Note</div>
                    <div class="note-text" id="managerNote">Loading...</div>
                    <div class="note-author" id="noteAuthor"></div>
                </div>

                <div class="quote-card">
                    <span class="quote-mark">"</span>
                    <div class="label">ðŸ’¡ Daily Inspiration</div>
                    <div class="quote-text" id="quoteText"></div>
                    <div class="quote-author" id="quoteAuthor"></div>
                </div>
            </aside>
        </main>

        <footer class="footer">
            <span class="status-dot"></span>
            Auto-refresh enabled Â· Last updated: <span id="lastUpdated">--</span>
        </footer>
    </div>

    <script>
        const CONFIG = {
            CALENDAR_DB_ID: '2f042fe32264805caeced964c5c1228e',
            NOTES_DB_ID: '2f042fe32264809297d6f75dfd050fa0',
            REFRESH_INTERVAL: 300000,
            API_ENDPOINT: '/api/notion'
        };

        const QUOTES = [
            { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
            { text: "Excellence is not a skill, it's an attitude.", author: "Ralph Marston" },
            { text: "Teamwork makes the dream work.", author: "John C. Maxwell" },
            { text: "The secret of getting ahead is getting started.", author: "Mark Twain" },
            { text: "Success usually comes to those who are too busy to be looking for it.", author: "Henry David Thoreau" },
            { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
            { text: "Quality is not an act, it is a habit.", author: "Aristotle" },
            { text: "The best way to predict the future is to create it.", author: "Peter Drucker" },
            { text: "Your most unhappy customers are your greatest source of learning.", author: "Bill Gates" },
            { text: "Coming together is a beginning, staying together is progress, working together is success.", author: "Henry Ford" },
            { text: "Hospitality is simply an opportunity to show love and care.", author: "Unknown" },
            { text: "Great things in business are never done by one person.", author: "Steve Jobs" },
            { text: "It's not about perfect. It's about effort.", author: "Jillian Michaels" },
            { text: "The way to get started is to quit talking and begin doing.", author: "Walt Disney" },
            { text: "Success is the sum of small efforts repeated day in and day out.", author: "Robert Collier" },
            { text: "Customers will never love a company until the employees love it first.", author: "Simon Sinek" },
            { text: "The customer's perception is your reality.", author: "Kate Zabriskie" },
            { text: "Kindness in words creates confidence. Kindness in thinking creates profoundness. Kindness in giving creates love.", author: "Lao Tzu" },
            { text: "Alone we can do so little; together we can do so much.", author: "Helen Keller" },
            { text: "The strength of the team is each member. The strength of each member is the team.", author: "Phil Jackson" },
            { text: "People don't care how much you know until they know how much you care.", author: "Theodore Roosevelt" },
            { text: "Service to others is the rent you pay for your room here on earth.", author: "Muhammad Ali" },
            { text: "The goal is not to be perfect by the end. The goal is to be better today.", author: "Simon Sinek" },
            { text: "Be the change you wish to see in the world.", author: "Mahatma Gandhi" },
            { text: "Every job is a self-portrait of the person who did it. Autograph your work with excellence.", author: "Unknown" },
            { text: "If you want to lift yourself up, lift up someone else.", author: "Booker T. Washington" },
            { text: "A satisfied customer is the best business strategy of all.", author: "Michael LeBoeuf" },
            { text: "Hard work beats talent when talent doesn't work hard.", author: "Tim Notke" },
            { text: "Success is not the key to happiness. Happiness is the key to success.", author: "Albert Schweitzer" },
            { text: "The pessimist sees difficulty in every opportunity. The optimist sees opportunity in every difficulty.", author: "Winston Churchill" },
            { text: "Wherever you go, go with all your heart.", author: "Confucius" }
        ];

        let calendarDate = new Date();
        let managerSchedule = {};
        let dailyNotes = {};
        let calendarEvents = []; // Events with tags (Important, Birthday, Party)

        // ============================================
        // LOCAL DATE HELPERS (NO TIMEZONE ISSUES)
        // ============================================
        function getLocalDateKey(date) {
            // Returns YYYY-MM-DD in LOCAL timezone (not UTC)
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getTodayKey() {
            return getLocalDateKey(new Date());
        }

        function parseNotionDate(dateStr) {
            // Notion returns dates as "2026-01-22" or "2026-01-22T00:00:00.000Z"
            // We just want the YYYY-MM-DD part, treated as local date
            if (!dateStr) return null;
            return dateStr.split('T')[0];
        }

        // Theme Toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton(newTheme);
        }

        function updateThemeButton(theme) {
            const icon = document.getElementById('themeIcon');
            const text = document.getElementById('themeText');
            if (theme === 'dark') {
                icon.textContent = 'â˜€ï¸';
                text.textContent = 'Light';
            } else {
                icon.textContent = 'ðŸŒ™';
                text.textContent = 'Dark';
            }
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeButton(savedTheme);
        }

        // Utility Functions
        function formatDate(date) {
            return date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }

        function formatDateShort(date) {
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function formatEventDate(dateStr) {
            // dateStr is YYYY-MM-DD
            const [year, month, day] = dateStr.split('-').map(Number);
            const date = new Date(year, month - 1, day);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function getDayOfYear() {
            const now = new Date();
            const start = new Date(now.getFullYear(), 0, 0);
            return Math.floor((now - start) / (1000 * 60 * 60 * 24));
        }

        function getQuoteOfTheDay() {
            return QUOTES[getDayOfYear() % QUOTES.length];
        }

        // Extract manager name from formats like "Z on duty", "A On Duty", or just "Z"
        function extractManagerName(rawName) {
            if (!rawName) return '';
            let name = rawName
                .replace(/\s*(on duty|on-duty|manager|- manager|\(manager\))\s*/gi, '')
                .trim();
            return name || rawName;
        }

        function displayQuote() {
            const quote = getQuoteOfTheDay();
            document.getElementById('quoteText').textContent = quote.text;
            document.getElementById('quoteAuthor').textContent = 'â€” ' + quote.author;
        }

        // Notion API Functions
        async function fetchNotionDatabase(databaseId) {
            try {
                const response = await fetch(CONFIG.API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ databaseId: databaseId })
                });
                if (!response.ok) throw new Error('API error: ' + response.status);
                return await response.json();
            } catch (error) {
                console.error('Error fetching from Notion:', error);
                return null;
            }
        }

        async function loadManagerSchedule() {
            const data = await fetchNotionDatabase(CONFIG.CALENDAR_DB_ID);
            if (!data || !data.results) {
                console.error('Failed to load manager schedule');
                return;
            }
            
            managerSchedule = {};
            calendarEvents = [];
            
            console.log('Loading calendar data...');
            
            data.results.forEach((page, index) => {
                const props = page.properties;
                let dateValue = null;
                let managerValue = null;
                let description = null;
                let tags = [];
                
                // Debug: log ALL properties for first few entries
                if (index < 3) {
                    console.log(`Page ${index} properties:`, JSON.stringify(props, null, 2));
                }
                
                for (const [key, prop] of Object.entries(props)) {
                    const keyLower = key.toLowerCase();
                    
                    // Get date (from "Date" property)
                    if (prop.type === 'date' && prop.date) {
                        dateValue = parseNotionDate(prop.date.start);
                    }
                    
                    // Get manager name from title (the "Name" column - like "Z" or "A")
                    if (prop.type === 'title' && prop.title && prop.title.length > 0) {
                        managerValue = prop.title[0].plain_text;
                    }
                    
                    // Get Description (rich_text) - check various possible names
                    if (keyLower === 'description' && prop.type === 'rich_text' && prop.rich_text) {
                        description = prop.rich_text.map(t => t.plain_text).join('');
                        console.log(`Found Description: "${description}"`);
                    }
                    
                    // Get Tags (multi_select or select)
                    if (keyLower === 'tags') {
                        if (prop.type === 'multi_select' && prop.multi_select) {
                            tags = prop.multi_select.map(t => t.name.toLowerCase());
                            console.log(`Found Tags (multi_select):`, tags);
                        } else if (prop.type === 'select' && prop.select) {
                            tags = [prop.select.name.toLowerCase()];
                            console.log(`Found Tags (select):`, tags);
                        }
                    }
                }
                
                if (dateValue && managerValue) {
                    const cleanName = extractManagerName(managerValue);
                    managerSchedule[dateValue] = cleanName;
                    console.log(`Schedule: ${dateValue} = "${cleanName}"`);
                    
                    // If there's a tag, add to events (description can be optional)
                    if (tags.length > 0) {
                        calendarEvents.push({
                            date: dateValue,
                            description: description || 'No description',
                            tag: tags[0],
                            manager: cleanName
                        });
                        console.log(`Event added: ${dateValue} - ${tags[0]} - "${description || 'No description'}"`);
                    }
                }
            });
            
            // Sort events by date
            calendarEvents.sort((a, b) => a.date.localeCompare(b.date));
            
            console.log('Final schedule:', managerSchedule);
            console.log('Events:', calendarEvents);
        }

        async function loadDailyNotes() {
            const data = await fetchNotionDatabase(CONFIG.NOTES_DB_ID);
            if (!data || !data.results) return;
            
            dailyNotes = {};
            
            console.log('Loading daily notes...');
            
            data.results.forEach(page => {
                const props = page.properties;
                let dateValue = null;
                let noteValue = null;
                let managerValue = null;
                
                for (const [key, prop] of Object.entries(props)) {
                    const keyLower = key.toLowerCase();
                    
                    // Get date
                    if (prop.type === 'date' && prop.date) {
                        dateValue = parseNotionDate(prop.date.start);
                    }
                    
                    // Get note from "Daily note" column
                    if (keyLower.includes('daily') || keyLower.includes('note')) {
                        if (prop.type === 'rich_text' && prop.rich_text && prop.rich_text.length > 0) {
                            noteValue = prop.rich_text.map(t => t.plain_text).join('');
                        }
                    }
                    
                    // Get manager name from "Manager Name" title column
                    if (keyLower.includes('manager') || keyLower === 'name') {
                        if (prop.type === 'title' && prop.title && prop.title.length > 0) {
                            managerValue = prop.title[0].plain_text;
                        }
                    }
                }
                
                if (dateValue) {
                    dailyNotes[dateValue] = { 
                        note: noteValue || '', 
                        manager: managerValue ? extractManagerName(managerValue) : '' 
                    };
                    console.log(`Note: ${dateValue} = "${noteValue}" by ${managerValue}`);
                }
            });
            
            console.log('Final notes:', dailyNotes);
        }

        // UI Update Functions
        function updateCurrentDate() {
            document.getElementById('currentDate').textContent = formatDate(new Date());
            document.getElementById('todayDate').textContent = formatDateShort(new Date());
        }

        function updateTodayManager() {
            const todayKey = getTodayKey();
            console.log('Today key:', todayKey);
            console.log('Available dates:', Object.keys(managerSchedule));
            
            const manager = managerSchedule[todayKey] || '--';
            document.getElementById('todayManager').textContent = manager;
        }

        function updateDailyNote() {
            const todayKey = getTodayKey();
            const noteData = dailyNotes[todayKey];
            const noteEl = document.getElementById('managerNote');
            const authorEl = document.getElementById('noteAuthor');
            
            console.log('Looking for note on:', todayKey);
            console.log('Available note dates:', Object.keys(dailyNotes));
            
            if (noteData && noteData.note && noteData.note.trim()) {
                noteEl.textContent = noteData.note;
                noteEl.classList.remove('empty');
                authorEl.textContent = noteData.manager ? 'â€” ' + noteData.manager : '';
            } else {
                noteEl.textContent = 'No team notes for today';
                noteEl.classList.add('empty');
                authorEl.textContent = '';
            }
        }

        function updateEvents() {
            const eventsContainer = document.getElementById('eventsList');
            const eventsSection = document.getElementById('eventsSection');
            const currentMonth = calendarDate.getMonth();
            const currentYear = calendarDate.getFullYear();
            
            // Filter events for the displayed month
            const monthEvents = calendarEvents.filter(event => {
                const [year, month] = event.date.split('-').map(Number);
                return year === currentYear && month === currentMonth + 1;
            });
            
            if (monthEvents.length === 0) {
                eventsSection.style.display = 'none';
                return;
            }
            
            eventsSection.style.display = 'block';
            
            let html = '';
            monthEvents.forEach(event => {
                const tagClass = event.tag.toLowerCase();
                html += `
                    <div class="event-item ${tagClass}">
                        <span class="event-date">${formatEventDate(event.date)}</span>
                        <span class="event-tag ${tagClass}">${event.tag}</span>
                        <span class="event-description">${event.description}</span>
                    </div>
                `;
            });
            
            eventsContainer.innerHTML = html;
        }

        function renderCalendar() {
            const year = calendarDate.getFullYear();
            const month = calendarDate.getMonth();
            
            document.getElementById('calendarMonth').textContent = 
                calendarDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startingDay = firstDay.getDay();
            const totalDays = lastDay.getDate();
            const todayKey = getTodayKey();
            
            const grid = document.getElementById('calendarGrid');
            const headers = grid.querySelectorAll('.calendar-header');
            grid.innerHTML = '';
            headers.forEach(h => grid.appendChild(h));
            
            // Previous month days
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day other-month';
                const prevMonthLastDay = new Date(year, month, 0).getDate();
                emptyDay.innerHTML = `<span class="day-number">${prevMonthLastDay - startingDay + i + 1}</span>`;
                grid.appendChild(emptyDay);
            }
            
            // Current month days
            for (let day = 1; day <= totalDays; day++) {
                // Build date key in local timezone
                const monthStr = String(month + 1).padStart(2, '0');
                const dayStr = String(day).padStart(2, '0');
                const dateKey = `${year}-${monthStr}-${dayStr}`;
                
                const dayEl = document.createElement('div');
                const isToday = dateKey === todayKey;
                dayEl.className = 'calendar-day' + (isToday ? ' today' : '');
                
                const manager = managerSchedule[dateKey] || '';
                dayEl.innerHTML = `
                    <span class="day-number">${day}</span>
                    ${manager ? `<span class="manager-name">${manager}</span>` : ''}
                `;
                grid.appendChild(dayEl);
            }
            
            // Next month days
            const remainingCells = (7 - ((startingDay + totalDays) % 7)) % 7;
            for (let i = 1; i <= remainingCells; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day other-month';
                emptyDay.innerHTML = `<span class="day-number">${i}</span>`;
                grid.appendChild(emptyDay);
            }
            
            // Update events for this month
            updateEvents();
        }

        function changeMonth(delta) {
            calendarDate.setMonth(calendarDate.getMonth() + delta);
            renderCalendar();
        }

        function goToToday() {
            calendarDate = new Date();
            renderCalendar();
        }

        function updateLastUpdated() {
            document.getElementById('lastUpdated').textContent = 
                new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }

        // Initialize
        async function init() {
            loadTheme();
            updateCurrentDate();
            displayQuote();
            
            await Promise.all([loadManagerSchedule(), loadDailyNotes()]);
            
            updateTodayManager();
            updateDailyNote();
            renderCalendar();
            updateLastUpdated();
        }

        async function refresh() {
            await Promise.all([loadManagerSchedule(), loadDailyNotes()]);
            updateCurrentDate();
            updateTodayManager();
            updateDailyNote();
            renderCalendar();
            updateLastUpdated();
            displayQuote();
        }

        document.addEventListener('DOMContentLoaded', () => {
            init();
            setInterval(refresh, CONFIG.REFRESH_INTERVAL);
        });
    </script>
</body>
</html>
